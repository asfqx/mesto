(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Tp:()=>E,qK:()=>w});var t={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"12a9a912-9a09-4af7-9613-2eb6af32d0ca","Content-Type":"application/json"}};function n(e){var t=E.querySelector(".places__item").cloneNode(!0),n=t.querySelector(".card__like-button"),c=t.querySelector(".card__delete-button"),a=t.querySelector(".card__image"),i=t.querySelector(".card__like-digit");return a.src=e.link,a.alt=e.name,t.id=e._id,i.textContent=e.likes?e.likes.length:0,t.querySelector(".card__title").textContent=e.name,a.addEventListener("click",w),n.addEventListener("click",o),c.addEventListener("click",r),t}function o(e){e.target.classList.toggle("card__like-button_is-active");var n,o=e.target.closest("li.card"),r=o.querySelector(".card__like-digit");e.target.classList.contains("card__like-button_is-active")?(n=o.id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:t.headers.authorization}}).then(function(e){return e.ok?e.json():Promise.reject("Request to like card is not ok")})).then(function(e){r.textContent=e.likes.length}):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:t.headers.authorization}}).then(function(e){return e.ok?e.json():Promise.reject("Request to delete like from card is not ok")})}(o.id).then(function(e){r.textContent=e.likes.length})}function r(e){var n,o=e.target.closest("li.card");n=o.id,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:{authorization:t.headers.authorization}}).then(function(e){return e.ok?e.json():Promise.reject("Request to delete card is not ok")}),o.remove()}function c(e){e.classList.add("popup_is-opened")}function a(e){e.classList.remove("popup_is-opened")}function i(e,t){!function(e){return e.some(function(e){return!e.validity.valid})}(t)?e.classList.remove("popup__button_inactive"):e.classList.add("popup__button_inactive")}var u=document.querySelector(".profile__edit-button"),s=document.querySelector(".places__list"),l=document.querySelector(".popup_type_edit"),d=document.querySelector(".popup_type_new-card"),p=document.forms["new-place"],f=p.elements["place-name"],_=p.elements.link,m=document.querySelector(".popup_type_image"),h=document.querySelector(".popup__image"),v=document.querySelector(".popup__caption"),y=document.querySelectorAll(".popup__close"),k=document.forms["edit-profile"],q=k.elements.name,S=k.elements.description,b=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),L=document.querySelector(".profile__add-button"),E=document.querySelector("#card-template").content,C=document.querySelectorAll(".popup__form"),x=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_new-avatar"),P=document.forms.avatar,z=P.elements.link,U=document.querySelector(".profile__image-overlay"),T=document.querySelector(".profile__edit-icon"),A=p.elements.submit,O=p.elements.submit,R=p.elements.submit;function w(e){var t=e.target.closest(".places__item").querySelector(".card__title").textContent;h.src=e.target.src,v.textContent=t,c(m)}function D(){c(j),z.value=x.src}fetch("".concat(t.baseUrl,"/users/me"),{headers:{authorization:t.headers.authorization}}).then(function(e){return e.ok?e.json():Promise.reject("Request to get start user info is not ok")}).then(function(e){console.log(e),g.textContent=e.about,b.textContent=e.name,x.src=e.avatar}).catch(function(e){return console.log(e)}),m.classList.add("popup_is-animated"),d.classList.add("popup_is-animated"),l.classList.add("popup_is-animated"),fetch("".concat(t.baseUrl,"/cards"),{headers:{authorization:t.headers.authorization}}).then(function(e){return e.ok?e.json():Promise.reject("Request to get card is not ok")}).then(function(e){e.forEach(function(e){var t=n(e);e.likes.forEach(function(e){e.name==b.textContent&&t.querySelector(".card__like-button").classList.add("card__like-button_is-active")}),s.appendChild(t)})}).catch(function(e){return console.log(e)}),P.addEventListener("submit",function(e){var n;e.preventDefault(),O.textContent="Сохранение...",(n=z.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then(function(e){return e.ok?e.json:Promise.reject("Request to edit avatar is not ok")})).then(function(){x.src=z.value}).catch(function(e){return console.log(e)}).finally(function(){O.textContent="Сохранить",a(j)})}),U.addEventListener("click",D),T.addEventListener("click",D),k.addEventListener("submit",function(e){var n,o;e.preventDefault(),R.textContent="Сохранение...",(n=q.value,o=S.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:o})})).then(function(){g.textContent=S.value,b.textContent=q.value}).catch(function(e){return console.log(e)}).finally(function(){R.textContent="Сохранить",a(l)})}),u.addEventListener("click",function(){c(l),q.value=b.textContent,S.value=g.textContent}),L.addEventListener("click",function(){c(d),f.value="",_.value=""}),p.addEventListener("submit",function(e){var o,r;e.preventDefault(),A.textContent="Создание...",(o=f.value,r=_.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:o,link:r})}).then(function(e){return e.ok?e.json():Promise.reject("Request to create card is not ok")})).then(function(e){var t=n(e);s.prepend(t)}).catch(function(e){return console.log(e)}).finally(function(){A.textContent="Создать",a(d)})}),y.forEach(function(e){return e.addEventListener("click",function(){return a(document.querySelector(".popup_is-opened"))})}),document.querySelectorAll(".popup").forEach(function(e){e.addEventListener("mousedown",function(t){t.target===e&&a(e)})}),document.addEventListener("keydown",function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&a(t)}}),function(e){e.forEach(function(e){e.addEventListener("submit",function(e){return e.preventDefault()}),function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");i(n,t),t.forEach(function(o){o.addEventListener("input",function(){!function(e,t){t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__input-error_active"),n.textContent=""}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.classList.add("popup__input-error_active"),o.textContent=n}(e,t,t.validationMessage)}(e,o),i(n,t)})})}(e)})}(C)})();